<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒåœºé€é•œ (Project Lens) v4.0</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.8/dist/purify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;700&display=swap');
        :root { --background-color: #121212; --surface-color: #1e1e1e; --primary-color: #9b59b6; --text-color: #e0e0e0; --text-secondary-color: #a0a0a0; --border-color: #333; --card-padding: 30px; }
        html.light-mode { --background-color: #f4f5f7; --surface-color: #ffffff; --primary-color: #007bff; --text-color: #333333; --text-secondary-color: #777777; --border-color: #e0e0e0; }
        body { font-family: 'Inter', 'Noto Sans SC', 'Noto Sans TC', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 20px; box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
        .header { width: 100%; max-width: 1400px; margin: 0 auto 20px auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 700; }
        .controls { display: flex; align-items: center; gap: 15px; }
        .theme-switcher { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); cursor: pointer; font-size: 24px; padding: 5px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .theme-switcher:hover { color: var(--text-color); background-color: var(--surface-color); }
        .main-container { display: flex; gap: 20px; width: 100%; max-width: 1400px; margin: 0 auto; height: calc(100vh - 100px); }
        .panel { background-color: var(--surface-color); border-radius: 16px; border: 1px solid var(--border-color); padding: var(--card-padding); box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: background-color 0.3s, border-color 0.3s; display: flex; flex-direction: column; }
        .input-panel, .output-panel { flex: 1; overflow-y: auto; }
        h1 { font-size: 28px; margin-top: 0; margin-bottom: 10px; }
        .subtitle { color: var(--text-secondary-color); margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; font-size: 14px; }
        textarea, input[type="text"] { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 15px; box-sizing: border-box; background-color: var(--background-color); color: var(--text-color); }
        textarea { resize: vertical; }
        .analyze-button { width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.3s; display: flex; justify-content: center; align-items: center; margin-top: auto; }
        .analyze-button:disabled { background: #555; cursor: not-allowed; }
        #result-container { line-height: 1.7; }
        #result-container h2 { font-size: 20px; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-top: 25px; }
        .sources-container { margin-top: 20px; font-size: 14px; }
        .sources-container a { color: var(--text-secondary-color); text-decoration: none; }
        .sources-container a:hover { text-decoration: underline; }
        .spinner { border: 3px solid rgba(255,255,255,0.2); width: 18px; height: 18px; border-radius: 50%; border-left-color: #fff; animation: spin 1s ease infinite; display: inline-block; vertical-align: middle; margin-left: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .citation-link { color: var(--primary-color); text-decoration: none; font-weight: bold; vertical-align: super; font-size: 0.8em; margin: 0 2px; }
        .citation-link:hover { text-decoration: underline; }
        .source-item { display: flex; align-items: center; padding: 4px 0; } /* Flexbox for alignment */
        .lang-toggle { display: flex; border: 1px solid var(--border-color); border-radius: 20px; overflow: hidden; background-color: var(--surface-color); }
        .lang-toggle button { background: none; border: none; color: var(--text-secondary-color); padding: 8px 16px; cursor: pointer; transition: all 0.2s ease-in-out; font-size: 15px; font-weight: 500; }
        .lang-toggle button:not(:last-child) { border-right: 1px solid var(--border-color); }
        .lang-toggle button.active { background-color: var(--primary-color); color: white; }
        .lang-toggle button:hover:not(.active) { color: var(--text-color); }
        
        /* --- ã€æ–°å¢æ ·å¼ã€‘ç»™å°å›¾æ ‡åŒ–å¦† --- */
        .source-icon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            flex-shrink: 0; /* Prevent icon from shrinking */
            color: var(--text-secondary-color);
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo" id="logo">ğŸ”¬ èŒåœºé€é•œ</div>
        <div class="controls">
            <button class="theme-switcher" id="theme-switcher">â˜€ï¸</button>
            <div class="lang-toggle" id="lang-toggle">
                <button data-lang="zh-CN">ç®€</button>
                <button data-lang="zh-TW">ç¹</button>
                <button data-lang="en">EN</button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <section class="panel input-panel">
            <div>
                <h1 data-key="title">è¾“å…¥ä¿¡æ¯</h1>
                <p class="subtitle" data-key="subtitle">AIå°†è‡ªåŠ¨æœç´¢å¹¶åˆ†æè¯¥å…¬å¸</p>
                <div class="form-group">
                    <label for="company-name" data-key="company_name_label">å…¬å¸åç§°</label>
                    <input type="text" id="company-name" data-key-placeholder="company_name_placeholder">
                </div>
                <div class="form-group">
                    <label for="job-title" data-key="job_title_label">èŒä½åç§° (å¯é€‰)</label>
                    <input type="text" id="job-title" data-key-placeholder="job_title_placeholder">
                </div>
                <div class="form-group">
                    <label for="resume-text" data-key="resume_label">æˆ‘çš„ç®€å† / ä¸ªäººç®€ä»‹ (å¯é€‰)</label>
                    <textarea id="resume-text" rows="6" data-key-placeholder="resume_placeholder"></textarea>
                </div>
            </div>
            <button class="analyze-button" id="analyze-button">
                <span data-key="button_text">å¼€å§‹åˆ†æ</span>
            </button>
        </section>

        <section class="panel output-panel">
            <div id="result-container">
                <h2 data-key="result_placeholder_title">åˆ†ææŠ¥å‘Š</h2>
                <p data-key="result_placeholder_text" style="color: var(--text-secondary-color);">ï¼ˆè¯·è¾“å…¥å…¬å¸ååç‚¹å‡»åˆ†æï¼‰</p>
            </div>
            <div class="sources-container" id="sources-container"></div>
        </section>
    </main>

    <script>
        // --- 1. å…ƒç´ è·å– (æ— å˜åŒ–) ---
        const companyNameInput = document.getElementById('company-name');
        const jobTitleInput = document.getElementById('job-title');
        const resumeTextInput = document.getElementById('resume-text');
        const analyzeButton = document.getElementById('analyze-button');
        const resultContainer = document.getElementById('result-container');
        const sourcesContainer = document.getElementById('sources-container');
        const themeSwitcher = document.getElementById('theme-switcher');
        const logo = document.getElementById('logo');
        const langToggle = document.getElementById('lang-toggle');

        // --- 2. API é…ç½® (æ— å˜åŒ–) ---
        const API_URL = 'https://project-lens-backend-885033581194.us-central1.run.app/analyze'; 

        // --- 3. å›½é™…åŒ– (i18n) é…ç½® (æ— å˜åŒ–) ---
        const translations = {
            'zh-CN': { logo_text: 'ğŸ”¬ èŒåœºé€é•œ', title: 'è¾“å…¥ä¿¡æ¯', subtitle: 'AIå°†è‡ªåŠ¨æœç´¢å¹¶åˆ†æè¯¥å…¬å¸', company_name_label: 'å…¬å¸åç§°', company_name_placeholder: 'ä¾‹å¦‚ï¼šè¥¿å®‰å¤§ç•¥å¤§å­¦', job_title_label: 'èŒä½åç§° (å¯é€‰)', job_title_placeholder: 'ä¾‹å¦‚ï¼šè½¯ä»¶å·¥ç¨‹å¸ˆ, å¸‚åœºç»ç†', resume_label: 'æˆ‘çš„ç®€å† / ä¸ªäººç®€ä»‹ (å¯é€‰)', resume_placeholder: 'ç²˜è´´ä½ çš„ä¸ªäººç®€ä»‹æˆ–ç®€å†ï¼Œè·å¾—æ›´ç²¾å‡†çš„åŒ¹é…åˆ†æ...', button_text: 'å¼€å§‹åˆ†æ', button_loading_text: 'æœç´¢åˆ†æä¸­...', result_placeholder_title: 'åˆ†ææŠ¥å‘Š', result_placeholder_text: 'ï¼ˆè¯·è¾“å…¥å…¬å¸ååç‚¹å‡»åˆ†æï¼‰', sources_title: 'å¼•ç”¨æ¥æº:' },
            'zh-TW': { logo_text: 'ğŸ”¬ è·å ´é€é¡', title: 'è¼¸å…¥è³‡è¨Š', subtitle: 'AIå°‡è‡ªå‹•æœç´¢ä¸¦åˆ†æè©²å…¬å¸', company_name_label: 'å…¬å¸åç¨±', company_name_placeholder: 'ä¾‹å¦‚ï¼šè¥¿å®‰å¤§ç•¥å¤§å­¸', job_title_label: 'è·ä½åç¨± (å¯é¸)', job_title_placeholder: 'ä¾‹å¦‚ï¼šè»Ÿé«”å·¥ç¨‹å¸«, å¸‚å ´ç¶“ç†', resume_label: 'æˆ‘çš„å±¥æ­· / å€‹äººç°¡ä»‹ (å¯é¸)', resume_placeholder: 'è²¼ä¸Šä½ çš„å€‹äººç°¡ä»‹æˆ–å±¥æ­·ï¼Œç²å¾—æ›´ç²¾æº–çš„åŒ¹é…åˆ†æ...', button_text: 'é–‹å§‹åˆ†æ', button_loading_text: 'æœç´¢åˆ†æä¸­...', result_placeholder_title: 'åˆ†æå ±å‘Š', result_placeholder_text: 'ï¼ˆè«‹è¼¸å…¥å…¬å¸åå¾Œé»æ“Šåˆ†æï¼‰', sources_title: 'è³‡è¨Šä¾†æº:' },
            'en':    { logo_text: 'ğŸ”¬ Project Lens', title: 'Input Information', subtitle: 'AI will automatically search and analyze the company', company_name_label: 'Company Name', company_name_placeholder: 'e.g., University of Western Ontario', job_title_label: 'Job Title (Optional)', job_title_placeholder: 'e.g., Software Engineer, Marketing Manager', resume_label: 'My Resume / Bio (Optional)', resume_placeholder: 'Paste your bio or resume for a more accurate culture-fit analysis...', button_text: 'Analyze', button_loading_text: 'Searching & Analyzing...', result_placeholder_title: 'Analysis Report', result_placeholder_text: '(Enter a company name and click Analyze)', sources_title: 'References:' }
        };
        
        // --- ã€æ–°å¢ã€‘å›¾æ ‡åº“ ---
        const ICONS = {
            linkedin: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/></svg>`,
            glassdoor: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.185 1.185A1.5 1.5 0 0 1 2.57.293l10.854 10.854a.5.5 0 0 1 0 .708L11.146 14a.5.5 0 0 1-.708 0L.293 2.854A1.5 1.5 0 0 1 1.185 1.185zM14.815 1.185a1.5 1.5 0 0 0-2.122 0L.854 13.146a.5.5 0 0 0 0 .708L2.854 15.707a.5.5 0 0 0 .708 0L15.707 3.565a1.5 1.5 0 0 0 0-2.122l-.892-.892z"/></svg>`,
            indeed: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.555 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM10.31 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM8.36 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM5.945 5.582a.363.363 0 0 0-.363.363v4.062a.363.363 0 0 0 .363.363h.363a.363.363 0 0 0 .363-.363V5.945a.363.363 0 0 0-.363-.363h-.363zM15.363 4.091A1.91 1.91 0 0 0 13.455 2.182h-10.91A1.91 1.91 0 0 0 .636 4.091v7.818A1.91 1.91 0 0 0 2.545 13.818h10.91a1.91 1.91 0 0 0 1.909-1.909V4.091zM2.909 5.227a1.136 1.136 0 1 1 0 2.273 1.136 1.136 0 0 1 0-2.273z"/></svg>`,
            default: `<svg class="source-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/></svg>`
        };

        // --- 4. æ ¸å¿ƒé€»è¾‘ (å·²æ›´æ–°) ---
        let currentLang = 'zh-CN';

        function setLanguage(langCode) {
            currentLang = langCode;
            document.documentElement.lang = langCode;
            const t = translations[langCode];
            document.querySelectorAll('[data-key]').forEach(elem => { const key = elem.getAttribute('data-key'); if (t[key]) elem.textContent = t[key]; });
            document.querySelectorAll('[data-key-placeholder]').forEach(elem => { const key = elem.getAttribute('data-key-placeholder'); if (t[key]) elem.placeholder = t[key]; });
            logo.textContent = t.logo_text;
            langToggle.querySelectorAll('button').forEach(button => button.classList.toggle('active', button.dataset.lang === langCode));
        }

        function setTheme(theme) {
            document.documentElement.classList.toggle('light-mode', theme === 'light');
            themeSwitcher.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', theme);
        }

        analyzeButton.addEventListener('click', async function() {
            const t = translations[currentLang];
            const buttonTextSpan = analyzeButton.querySelector('span');
            buttonTextSpan.textContent = t.button_loading_text;
            analyzeButton.insertAdjacentHTML('beforeend', '<div class="spinner"></div>');
            analyzeButton.disabled = true;
            resultContainer.innerHTML = `<h2>${t.result_placeholder_title}</h2><p>${t.button_loading_text}</p>`;
            sourcesContainer.innerHTML = '';

            const data = { companyName: companyNameInput.value, jobTitle: jobTitleInput.value, resumeText: resumeTextInput.value, language: currentLang };

            try {
                const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                const result = await response.json();
                if (response.ok) {
                    let analysisHtml = marked.parse(result.analysis || '');
                    analysisHtml = analysisHtml.replace(/\[(\d+)\]/g, (match, number) => `<a href="#source-${number}" class="citation-link">${match}</a>`);
                    resultContainer.innerHTML = DOMPurify.sanitize(analysisHtml);
                    
                    if (result.sources && result.sources.length > 0) {
                        let sourcesHTML = `<h2>${t.sources_title}</h2>`;
                        result.sources.forEach(source => {
                            // ã€æ ¸å¿ƒæ›´æ–°ã€‘æ ¹æ®åç«¯ä¼ æ¥çš„ source_type é€‰æ‹©å›¾æ ‡
                            const icon = ICONS[source.source_type] || ICONS.default;
                            sourcesHTML += `<div class="source-item" id="source-${source.id}">
                                              ${icon}
                                              <span>[${source.id}] <a href="${source.link}" target="_blank" rel="noopener noreferrer">${source.title}</a></span>
                                          </div>`;
                        });
                        sourcesContainer.innerHTML = DOMPurify.sanitize(sourcesHTML, {ADD_ATTR: ['id'], ADD_TAGS: ['svg', 'path']}); // å…è®¸SVGæ ‡ç­¾
                    }
                } else {
                    resultContainer.textContent = `Error: ${result.error}`;
                }
            } catch (error) {
                resultContainer.textContent = 'Connection error.';
            } finally {
                buttonTextSpan.textContent = t.button_text;
                if(analyzeButton.querySelector('.spinner')) analyzeButton.querySelector('.spinner').remove();
                analyzeButton.disabled = false;
            }
        });

        // --- 5. åˆå§‹åŒ– (æ— å˜åŒ–) ---
        themeSwitcher.addEventListener('click', () => setTheme(document.documentElement.classList.contains('light-mode') ? 'dark' : 'light'));
        langToggle.addEventListener('click', (event) => { if (event.target.tagName === 'BUTTON') { const langCode = event.target.dataset.lang; if (langCode && langCode !== currentLang) { setLanguage(langCode); } } });
        setTheme(localStorage.getItem('theme') || 'dark');
        setLanguage('zh-CN');
    </script>
</body>
</html>
